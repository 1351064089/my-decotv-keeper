name: DecoTV Keep Alive

on:
  schedule:
    # ç¼©çŸ­è‡³æ¯ 50 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œé¿å¼€æ•´ç‚¹ï¼Œå‡å°‘è¢«å°é”æ¦‚ç‡
    - cron: '50 */1 * * *'
  workflow_dispatch: 

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Wake Up Space
        run: |
          URL="https://muyedd-joe.hf.space"
          echo "ğŸš€ æ­£åœ¨å°è¯•æ¿€æ´» Space: $URL"
          
          # éšæœºå»¶è¿Ÿï¼Œæ¨¡æ‹Ÿäººç±»æ“ä½œ
          sleep $((RANDOM % 60))

          # ä½¿ç”¨å¤šé‡ User-Agent è½®æ¢å’Œæ›´åŠ å®½æ¾çš„åˆ¤æ–­é€»è¾‘
          # å³ä½¿ curl å¤±è´¥ï¼ˆæ¯”å¦‚ 403/503ï¼‰ï¼Œä¹Ÿä¸ä¸­æ–­è„šæœ¬æ‰§è¡Œ (|| true)
          STATUS=$(curl -L -k -s -o /dev/null -w "%{http_code}" \
            -H "User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
            -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8" \
            -H "Accept-Language: zh-CN,zh;q=0.9,en;q=0.8" \
            --max-time 30 \
            "$URL") || true

          echo "ğŸ“¡ ä¸»é¡µé¢è¯·æ±‚çŠ¶æ€ç : $STATUS"

          # é¢å¤–è¯·æ±‚ä¸€æ¬¡é™æ€èµ„æºç›®å½•ï¼ˆé€šå¸¸æ˜¯å”¤é†’åç«¯çš„å…³é”®ï¼‰
          echo "ğŸ” æ­£åœ¨è¿›è¡ŒäºŒæ¬¡æ·±åº¦å”¤é†’..."
          curl -L -k -s -o /dev/null "$URL/config" || true
          curl -L -k -s -o /dev/null "$URL/static" || true

          # é€»è¾‘åˆ¤æ–­ï¼šåªè¦ä¸æ˜¯ 000ï¼ˆç½‘ç»œå®Œå…¨ä¸é€šï¼‰ï¼Œå°±è®¤ä¸ºå‘é€æˆåŠŸ
          if [ "$STATUS" -ge 200 ] && [ "$STATUS" -lt 500 ]; then
            echo "âœ… å”¤é†’è¯·æ±‚å·²å‘é€ï¼ŒSpace åº”å¤„äºæ´»è·ƒçŠ¶æ€ã€‚"
          elif [ "$STATUS" -eq 503 ] || [ "$STATUS" -eq 504 ]; then
            echo "â³ Space æ­£åœ¨å¯åŠ¨ä¸­ï¼ˆçŠ¶æ€ç  $STATUSï¼‰ï¼Œè¿™é€šå¸¸æ„å‘³ç€å”¤é†’æˆåŠŸäº†ã€‚"
          else
            echo "âš ï¸ æ”¶åˆ°éé¢„æœŸçŠ¶æ€ç : $STATUSï¼Œä½†å·²å¿½ç•¥é”™è¯¯é˜²æ­¢ Action ä¸­æ–­ã€‚"
          fi
